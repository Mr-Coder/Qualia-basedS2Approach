<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COT-DIR - æ™ºèƒ½æ•°å­¦è§£é¢˜ç³»ç»Ÿ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.8em;
            font-weight: 700;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        .nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .nav a {
            padding: 12px 25px;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav a:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .nav a.active {
            background: #e74c3c;
        }
        
        .solve-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .solve-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-align: center;
        }
        
        .problem-input {
            margin-bottom: 30px;
        }
        
        .problem-input label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .problem-input textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .problem-input textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .strategy-selection {
            margin-bottom: 30px;
        }
        
        .strategy-selection label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .strategy-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .strategy-btn {
            padding: 10px 20px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .strategy-btn:hover {
            background: #3498db;
            color: white;
        }
        
        .strategy-btn.active {
            background: #3498db;
            color: white;
        }
        
        .solve-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .solve-btn {
            padding: 15px 30px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .solve-btn:hover {
            background: #219a52;
            transform: translateY(-2px);
        }
        
        .solve-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        
        .clear-btn {
            padding: 15px 30px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .clear-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
            display: none;
        }
        
        .loading.show {
            display: block;
        }
        
        .result-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: none;
        }
        
        .result-section.show {
            display: block;
        }
        
        .result-section h3 {
            color: #27ae60;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .answer-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #27ae60;
        }
        
        .answer-box .answer {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .answer-box .confidence {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .reasoning-steps {
            margin-top: 20px;
        }
        
        .reasoning-steps h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .step {
            background: #ecf0f1;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .step-number {
            font-weight: 600;
            color: #3498db;
            margin-bottom: 5px;
        }
        
        .step-description {
            color: #2c3e50;
            line-height: 1.5;
        }
        
        .entity-relationship-diagram {
            margin-top: 20px;
        }
        
        .entity-relationship-diagram h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        #diagram-container {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            min-height: 300px;
            position: relative;
        }
        
        .entity-node {
            background: #3498db;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            display: inline-block;
            margin: 10px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
            transition: all 0.3s ease;
        }
        
        .entity-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }
        
        .entity-node.person {
            background: #e74c3c;
        }
        
        .entity-node.object {
            background: #27ae60;
        }
        
        .entity-node.currency {
            background: #f39c12;
        }
        
        .entity-node.concept {
            background: #9b59b6;
        }
        
        .relationship-line {
            stroke: #34495e;
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }
        
        .relationship-label {
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: #2c3e50;
            border: 1px solid #bdc3c7;
        }
        
        .constraint-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .constraint-box h5 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .constraint-list {
            list-style: none;
            padding: 0;
        }
        
        .constraint-list li {
            background: rgba(255, 193, 7, 0.1);
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 4px;
            border-left: 3px solid #ffc107;
            font-size: 13px;
            color: #495057;
        }
        
        .examples-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .examples-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .example-problems {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .example-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .example-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .example-card h4 {
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .example-card p {
            color: #2c3e50;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
            }
            
            .solve-controls {
                flex-direction: column;
            }
            
            .strategy-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§  COT-DIR æ™ºèƒ½æ•°å­¦è§£é¢˜ç³»ç»Ÿ</h1>
            <p>Chain-of-Thought Directed Implicit Reasoning - æ•°å­¦æ¨ç†ä¸é—®é¢˜è§£å†³</p>
            <div class="nav">
                <a href="/" class="active">æ™ºèƒ½è§£é¢˜</a>
                <a href="/strategies">æ¨ç†ç­–ç•¥</a>
                <a href="/learning-guide">å­¦ä¹ æŒ‡å¯¼</a>
                <a href="/knowledge-map">çŸ¥è¯†å›¾è°±</a>
                <a href="/error-analysis">é”™é¢˜åˆ†æ</a>
            </div>
        </div>
        
        <div class="solve-section">
            <h2>ğŸ“ æ•°å­¦é—®é¢˜æ±‚è§£</h2>
            
            <div class="problem-input">
                <label for="problem-text">è¯·è¾“å…¥æ•°å­¦é—®é¢˜:</label>
                <textarea id="problem-text" placeholder="ä¾‹å¦‚ï¼šå°æ˜æœ‰5ä¸ªè‹¹æœï¼Œå°çº¢æœ‰3ä¸ªè‹¹æœï¼Œä»–ä»¬ä¸€å…±æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ"></textarea>
            </div>
            
            <div class="strategy-selection">
                <label>é€‰æ‹©æ¨ç†ç­–ç•¥:</label>
                <div class="strategy-buttons">
                    <button class="strategy-btn active" data-strategy="auto">è‡ªåŠ¨é€‰æ‹©</button>
                    <button class="strategy-btn" data-strategy="cot">æ€ç»´é“¾æ¨ç† (COT)</button>
                    <button class="strategy-btn" data-strategy="got">æ€ç»´å›¾æ¨ç† (GOT)</button>
                    <button class="strategy-btn" data-strategy="tot">æ€ç»´æ ‘æ¨ç† (TOT)</button>
                </div>
            </div>
            
            <div class="solve-controls">
                <button class="solve-btn" id="solve-btn">ğŸš€ å¼€å§‹è§£é¢˜</button>
                <button class="clear-btn" id="clear-btn">ğŸ—‘ï¸ æ¸…ç©º</button>
            </div>
            
            <div class="loading" id="loading">
                <p>ğŸ¤– æ­£åœ¨æ€è€ƒä¸­ï¼Œè¯·ç¨å€™...</p>
            </div>
        </div>
        
        <div class="result-section" id="result-section">
            <h3>ğŸ’¡ è§£é¢˜ç»“æœ</h3>
            <div class="answer-box">
                <div class="answer" id="answer-text">ç­”æ¡ˆå°†åœ¨è¿™é‡Œæ˜¾ç¤º</div>
                <div class="confidence" id="confidence-text">ç½®ä¿¡åº¦: --</div>
            </div>
            <div class="reasoning-steps">
                <h4>ğŸ” æ¨ç†è¿‡ç¨‹:</h4>
                <div id="steps-container">
                    <!-- æ¨ç†æ­¥éª¤å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
            
            <div class="entity-relationship-diagram">
                <h4>ğŸ¨ å®ä½“å…³ç³»å›¾:</h4>
                <div id="diagram-container">
                    <!-- å®ä½“å…³ç³»å›¾å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </div>
        
        <div class="examples-section">
            <h3>ğŸ“š ç¤ºä¾‹é—®é¢˜</h3>
            <div class="example-problems">
                <div class="example-card" data-problem="å°æ˜æœ‰5ä¸ªè‹¹æœï¼Œå°çº¢æœ‰3ä¸ªè‹¹æœï¼Œä»–ä»¬ä¸€å…±æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ">
                    <h4>åŸºç¡€åŠ æ³•é—®é¢˜</h4>
                    <p>å°æ˜æœ‰5ä¸ªè‹¹æœï¼Œå°çº¢æœ‰3ä¸ªè‹¹æœï¼Œä»–ä»¬ä¸€å…±æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ</p>
                </div>
                <div class="example-card" data-problem="ä¸€ä¸ªé•¿æ–¹å½¢çš„é•¿æ˜¯8ç±³ï¼Œå®½æ˜¯5ç±³ï¼Œæ±‚å®ƒçš„é¢ç§¯å’Œå‘¨é•¿ã€‚">
                    <h4>å‡ ä½•è®¡ç®—é—®é¢˜</h4>
                    <p>ä¸€ä¸ªé•¿æ–¹å½¢çš„é•¿æ˜¯8ç±³ï¼Œå®½æ˜¯5ç±³ï¼Œæ±‚å®ƒçš„é¢ç§¯å’Œå‘¨é•¿ã€‚</p>
                </div>
                <div class="example-card" data-problem="å°å¼ ä¹°äº†3æ”¯ç¬”ï¼Œæ¯æ”¯ç¬”5å…ƒï¼Œç»™äº†åº—ä¸»20å…ƒï¼Œåº”è¯¥æ‰¾å›å¤šå°‘é’±ï¼Ÿ">
                    <h4>åº”ç”¨é¢˜</h4>
                    <p>å°å¼ ä¹°äº†3æ”¯ç¬”ï¼Œæ¯æ”¯ç¬”5å…ƒï¼Œç»™äº†åº—ä¸»20å…ƒï¼Œåº”è¯¥æ‰¾å›å¤šå°‘é’±ï¼Ÿ</p>
                </div>
                <div class="example-card" data-problem="ä¸€ä¸ªç­çº§æœ‰40åå­¦ç”Ÿï¼Œå…¶ä¸­ç”·ç”Ÿå 60%ï¼Œå¥³ç”Ÿæœ‰å¤šå°‘äººï¼Ÿ">
                    <h4>ç™¾åˆ†æ¯”é—®é¢˜</h4>
                    <p>ä¸€ä¸ªç­çº§æœ‰40åå­¦ç”Ÿï¼Œå…¶ä¸­ç”·ç”Ÿå 60%ï¼Œå¥³ç”Ÿæœ‰å¤šå°‘äººï¼Ÿ</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let selectedStrategy = 'auto';
        
        // ç­–ç•¥é€‰æ‹©
        document.querySelectorAll('.strategy-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.strategy-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedStrategy = this.dataset.strategy;
            });
        });
        
        // ç¤ºä¾‹é—®é¢˜ç‚¹å‡»
        document.querySelectorAll('.example-card').forEach(card => {
            card.addEventListener('click', function() {
                document.getElementById('problem-text').value = this.dataset.problem;
            });
        });
        
        // æ¸…ç©ºæŒ‰é’®
        document.getElementById('clear-btn').addEventListener('click', function() {
            document.getElementById('problem-text').value = '';
            document.getElementById('result-section').classList.remove('show');
        });
        
        // è§£é¢˜æŒ‰é’®
        document.getElementById('solve-btn').addEventListener('click', function() {
            const problemText = document.getElementById('problem-text').value.trim();
            
            if (!problemText) {
                alert('è¯·è¾“å…¥æ•°å­¦é—®é¢˜');
                return;
            }
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loading').classList.add('show');
            document.getElementById('result-section').classList.remove('show');
            
            // æ¨¡æ‹ŸAPIè°ƒç”¨
            solveProblem(problemText, selectedStrategy);
        });
        
        function solveProblem(problem, strategy) {
            console.log('å¼€å§‹è§£é¢˜:', problem, strategy);
            
            // è°ƒç”¨å®é™…çš„è§£é¢˜API
            fetch('/api/solve', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    problem: problem,
                    strategy: strategy
                })
            })
            .then(response => {
                console.log('æ”¶åˆ°å“åº”:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('è§£ææ•°æ®:', data);
                document.getElementById('loading').classList.remove('show');
                
                if (data.success) {
                    displayResult(data);
                } else {
                    alert('è§£é¢˜å¤±è´¥: ' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                    console.error('è§£é¢˜å¤±è´¥:', data);
                }
            })
            .catch(error => {
                console.error('è¯·æ±‚é”™è¯¯:', error);
                document.getElementById('loading').classList.remove('show');
                alert('è¯·æ±‚å¤±è´¥: ' + error.message);
            });
        }
        
        function displayResult(result) {
            console.log('æ˜¾ç¤ºç»“æœ:', result);
            
            // æ˜¾ç¤ºç­”æ¡ˆ
            const answerElement = document.getElementById('answer-text');
            const confidenceElement = document.getElementById('confidence-text');
            
            if (answerElement) {
                answerElement.textContent = result.answer || 'æœªçŸ¥ç­”æ¡ˆ';
            }
            
            if (confidenceElement) {
                const confidence = result.confidence ? (result.confidence * 100).toFixed(1) : 'æœªçŸ¥';
                const strategy = result.strategy_used ? result.strategy_used.toUpperCase() : 'æœªçŸ¥';
                confidenceElement.textContent = `ç½®ä¿¡åº¦: ${confidence}% | ä½¿ç”¨ç­–ç•¥: ${strategy}`;
            }
            
            // æ˜¾ç¤ºæ¨ç†æ­¥éª¤
            const stepsContainer = document.getElementById('steps-container');
            if (stepsContainer) {
                stepsContainer.innerHTML = '';
                
                if (result.reasoning_steps && Array.isArray(result.reasoning_steps)) {
                    result.reasoning_steps.forEach(step => {
                        const stepDiv = document.createElement('div');
                        stepDiv.className = 'step';
                        stepDiv.innerHTML = `
                            <div class="step-number">æ­¥éª¤ ${step.step || '?'}</div>
                            <div class="step-description">${step.description || 'æ— æè¿°'}</div>
                        `;
                        stepsContainer.appendChild(stepDiv);
                    });
                } else {
                    stepsContainer.innerHTML = '<div class="step">æ²¡æœ‰è¯¦ç»†çš„æ¨ç†æ­¥éª¤</div>';
                }
            }
            
            // æ˜¾ç¤ºå®ä½“å…³ç³»å›¾
            const diagramContainer = document.getElementById('diagram-container');
            if (diagramContainer && result.entity_relationship_diagram) {
                displayEntityRelationshipDiagram(result.entity_relationship_diagram, diagramContainer);
            }
            
            // æ˜¾ç¤ºç»“æœåŒºåŸŸ
            const resultSection = document.getElementById('result-section');
            if (resultSection) {
                resultSection.classList.add('show');
            }
        }
        
        function displayEntityRelationshipDiagram(diagram, container) {
            container.innerHTML = '';
            
            // åˆ›å»ºé¢˜ç›®ç‰¹å®šçš„å®ä½“å…³ç³»å›¾æ ‡é¢˜
            const titleDiv = document.createElement('div');
            titleDiv.style.textAlign = 'center';
            titleDiv.style.marginBottom = '20px';
            titleDiv.style.padding = '15px';
            titleDiv.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            titleDiv.style.color = 'white';
            titleDiv.style.borderRadius = '10px';
            titleDiv.style.fontWeight = 'bold';
            titleDiv.style.fontSize = '16px';
            titleDiv.innerHTML = `ğŸ¯ "${document.getElementById('problem-text').value.slice(0, 30)}..." çš„å®ä½“å…³ç³»åˆ†æ`;
            container.appendChild(titleDiv);
            
            // åˆ›å»ºå¯è§†åŒ–çš„ç½‘ç»œå›¾
            const networkDiv = document.createElement('div');
            networkDiv.style.position = 'relative';
            networkDiv.style.height = '400px';
            networkDiv.style.background = 'white';
            networkDiv.style.border = '2px solid #e9ecef';
            networkDiv.style.borderRadius = '10px';
            networkDiv.style.padding = '20px';
            networkDiv.style.marginBottom = '20px';
            
            // åˆ›å»ºSVGç”»å¸ƒ
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '100%');
            svg.setAttribute('height', '100%');
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            
            // å®šä¹‰ç®­å¤´æ ‡è®°
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
            marker.setAttribute('id', 'arrowhead');
            marker.setAttribute('markerWidth', '10');
            marker.setAttribute('markerHeight', '7');
            marker.setAttribute('refX', '9');
            marker.setAttribute('refY', '3.5');
            marker.setAttribute('orient', 'auto');
            
            const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            polygon.setAttribute('points', '0 0, 10 3.5, 0 7');
            polygon.setAttribute('fill', '#34495e');
            
            marker.appendChild(polygon);
            defs.appendChild(marker);
            svg.appendChild(defs);
            
            // æ ¹æ®å®ä½“æ•°é‡è®¡ç®—å¸ƒå±€
            const entities = diagram.entities;
            const positions = calculateEntityPositions(entities.length);
            
            // ç»˜åˆ¶è¿æ¥çº¿ï¼ˆå…³ç³»ï¼‰
            diagram.relationships.forEach(rel => {
                const fromIndex = entities.findIndex(e => e.id === rel.from);
                const toIndex = entities.findIndex(e => e.id === rel.to);
                
                if (fromIndex !== -1 && toIndex !== -1) {
                    const fromPos = positions[fromIndex];
                    const toPos = positions[toIndex];
                    
                    // è®¡ç®—è¿æ¥ç‚¹ï¼ˆåœ†çš„è¾¹ç¼˜è€Œä¸æ˜¯ä¸­å¿ƒï¼‰
                    const dx = toPos.x - fromPos.x;
                    const dy = toPos.y - fromPos.y;
                    const distance = Math.sqrt(dx*dx + dy*dy);
                    const radius = 40; // å®ä½“åœ†çš„åŠå¾„
                    
                    const startX = fromPos.x + (dx/distance) * radius;
                    const startY = fromPos.y + (dy/distance) * radius;
                    const endX = toPos.x - (dx/distance) * radius;
                    const endY = toPos.y - (dy/distance) * radius;
                    
                    // ç»˜åˆ¶è¿æ¥çº¿
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', startX);
                    line.setAttribute('y1', startY);
                    line.setAttribute('x2', endX);
                    line.setAttribute('y2', endY);
                    line.setAttribute('stroke', '#34495e');
                    line.setAttribute('stroke-width', '3');
                    line.setAttribute('marker-end', 'url(#arrowhead)');
                    svg.appendChild(line);
                    
                    // æ·»åŠ å…³ç³»æ ‡ç­¾
                    const midX = (startX + endX) / 2;
                    const midY = (startY + endY) / 2;
                    
                    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    label.setAttribute('x', midX);
                    label.setAttribute('y', midY - 5);
                    label.setAttribute('text-anchor', 'middle');
                    label.setAttribute('font-size', '12px');
                    label.setAttribute('font-weight', 'bold');
                    label.setAttribute('fill', '#2c3e50');
                    label.textContent = `${rel.type}(${rel.weight})`;
                    
                    // æ·»åŠ ç™½è‰²èƒŒæ™¯
                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    const bbox = label.getBBox ? label.getBBox() : {x: midX-30, y: midY-15, width: 60, height: 20};
                    rect.setAttribute('x', bbox.x - 3);
                    rect.setAttribute('y', bbox.y - 3);
                    rect.setAttribute('width', bbox.width + 6);
                    rect.setAttribute('height', bbox.height + 6);
                    rect.setAttribute('fill', 'rgba(255,255,255,0.9)');
                    rect.setAttribute('stroke', '#bdc3c7');
                    rect.setAttribute('stroke-width', '1');
                    rect.setAttribute('rx', '3');
                    
                    svg.appendChild(rect);
                    svg.appendChild(label);
                }
            });
            
            networkDiv.appendChild(svg);
            
            // åˆ›å»ºå®ä½“èŠ‚ç‚¹ï¼ˆåœ¨SVGä¹‹ä¸Šï¼‰
            entities.forEach((entity, index) => {
                const pos = positions[index];
                const entityNode = document.createElement('div');
                entityNode.className = `entity-node ${entity.type}`;
                entityNode.style.position = 'absolute';
                entityNode.style.left = (pos.x - 40) + 'px';
                entityNode.style.top = (pos.y - 20) + 'px';
                entityNode.style.width = '80px';
                entityNode.style.height = '40px';
                entityNode.style.borderRadius = '20px';
                entityNode.style.display = 'flex';
                entityNode.style.alignItems = 'center';
                entityNode.style.justifyContent = 'center';
                entityNode.style.fontSize = '12px';
                entityNode.style.fontWeight = 'bold';
                entityNode.style.textAlign = 'center';
                entityNode.style.cursor = 'pointer';
                entityNode.style.zIndex = '10';
                
                let nodeText = entity.id;
                if (entity.value !== undefined) nodeText = `${entity.id}\n${entity.value}`;
                if (entity.quantity !== undefined) nodeText = `${entity.id}\n${entity.quantity}ä¸ª`;
                if (entity.owns !== undefined) nodeText = `${entity.id}\n${entity.owns}ä¸ª`;
                
                entityNode.textContent = nodeText;
                entityNode.title = `ç±»å‹: ${entity.type}\nå±æ€§: ${entity.properties ? entity.properties.join(', ') : 'æ— '}`;
                
                // æ·»åŠ æ‚¬åœæ•ˆæœ
                entityNode.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.1)';
                    this.style.boxShadow = '0 4px 15px rgba(0,0,0,0.3)';
                });
                
                entityNode.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
                });
                
                networkDiv.appendChild(entityNode);
            });
            
            container.appendChild(networkDiv);
            
            // åˆ›å»ºéšå«çº¦æŸæ˜¾ç¤º
            if (diagram.implicit_constraints && diagram.implicit_constraints.length > 0) {
                const constraintBox = document.createElement('div');
                constraintBox.className = 'constraint-box';
                
                const constraintTitle = document.createElement('h5');
                constraintTitle.textContent = 'âš–ï¸ é¢˜ç›®éšå«çº¦æŸæ¡ä»¶:';
                constraintBox.appendChild(constraintTitle);
                
                const constraintList = document.createElement('ul');
                constraintList.className = 'constraint-list';
                
                diagram.implicit_constraints.forEach(constraint => {
                    const constraintItem = document.createElement('li');
                    constraintItem.textContent = constraint;
                    constraintList.appendChild(constraintItem);
                });
                
                constraintBox.appendChild(constraintList);
                container.appendChild(constraintBox);
            }
            
            // æ·»åŠ äº¤äº’è¯´æ˜
            const interactionDiv = document.createElement('div');
            interactionDiv.style.marginTop = '15px';
            interactionDiv.style.padding = '10px';
            interactionDiv.style.background = '#f8f9fa';
            interactionDiv.style.borderRadius = '6px';
            interactionDiv.style.fontSize = '14px';
            interactionDiv.style.color = '#6c757d';
            interactionDiv.style.textAlign = 'center';
            interactionDiv.innerHTML = 'ğŸ’¡ å°†é¼ æ ‡æ‚¬åœåœ¨å®ä½“èŠ‚ç‚¹ä¸ŠæŸ¥çœ‹è¯¦ç»†å±æ€§ä¿¡æ¯';
            container.appendChild(interactionDiv);
        }
        
        function calculateEntityPositions(entityCount) {
            const width = 600; // å‡è®¾å®¹å™¨å®½åº¦
            const height = 300; // å‡è®¾å®¹å™¨é«˜åº¦
            const centerX = width / 2;
            const centerY = height / 2;
            const positions = [];
            
            if (entityCount === 1) {
                positions.push({x: centerX, y: centerY});
            } else if (entityCount === 2) {
                positions.push({x: centerX - 100, y: centerY});
                positions.push({x: centerX + 100, y: centerY});
            } else if (entityCount === 3) {
                positions.push({x: centerX, y: centerY - 80});
                positions.push({x: centerX - 100, y: centerY + 60});
                positions.push({x: centerX + 100, y: centerY + 60});
            } else if (entityCount === 4) {
                positions.push({x: centerX - 100, y: centerY - 60});
                positions.push({x: centerX + 100, y: centerY - 60});
                positions.push({x: centerX - 100, y: centerY + 60});
                positions.push({x: centerX + 100, y: centerY + 60});
            } else {
                // åœ†å½¢å¸ƒå±€
                const radius = Math.min(width, height) * 0.3;
                for (let i = 0; i < entityCount; i++) {
                    const angle = (2 * Math.PI * i) / entityCount - Math.PI / 2;
                    positions.push({
                        x: centerX + radius * Math.cos(angle),
                        y: centerY + radius * Math.sin(angle)
                    });
                }
            }
            
            return positions;
        }
    </script>
</body>
</html>