<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COT-DIR - 智能数学解题系统</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.8em;
            font-weight: 700;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        .nav {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .nav a {
            padding: 12px 25px;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .nav a:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .nav a.active {
            background: #e74c3c;
        }
        
        .solve-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .solve-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            text-align: center;
        }
        
        .problem-input {
            margin-bottom: 30px;
        }
        
        .problem-input label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .problem-input textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            resize: vertical;
            transition: border-color 0.3s;
        }
        
        .problem-input textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        .strategy-selection {
            margin-bottom: 30px;
        }
        
        .strategy-selection label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .strategy-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .strategy-btn {
            padding: 10px 20px;
            border: 2px solid #3498db;
            background: white;
            color: #3498db;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
        }
        
        .strategy-btn:hover {
            background: #3498db;
            color: white;
        }
        
        .strategy-btn.active {
            background: #3498db;
            color: white;
        }
        
        .solve-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .solve-btn {
            padding: 15px 30px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .solve-btn:hover {
            background: #219a52;
            transform: translateY(-2px);
        }
        
        .solve-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        
        .clear-btn {
            padding: 15px 30px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .clear-btn:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }
        
        .loading {
            text-align: center;
            padding: 30px;
            color: #7f8c8d;
            display: none;
        }
        
        .loading.show {
            display: block;
        }
        
        .result-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: none;
        }
        
        .result-section.show {
            display: block;
        }
        
        .result-section h3 {
            color: #27ae60;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .answer-box {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #27ae60;
        }
        
        .answer-box .answer {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .answer-box .confidence {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        .reasoning-steps {
            margin-top: 20px;
        }
        
        .reasoning-steps h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .step {
            background: #ecf0f1;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }
        
        .step-number {
            font-weight: 600;
            color: #3498db;
            margin-bottom: 5px;
        }
        
        .step-description {
            color: #2c3e50;
            line-height: 1.5;
        }
        
        .entity-relationship-diagram {
            margin-top: 20px;
        }
        
        .entity-relationship-diagram h4 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        #diagram-container {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            min-height: 300px;
            position: relative;
        }
        
        .entity-node {
            background: #3498db;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            display: inline-block;
            margin: 10px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
            transition: all 0.3s ease;
        }
        
        .entity-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.4);
        }
        
        .entity-node.person {
            background: #e74c3c;
        }
        
        .entity-node.object {
            background: #27ae60;
        }
        
        .entity-node.currency {
            background: #f39c12;
        }
        
        .entity-node.concept {
            background: #9b59b6;
        }
        
        .relationship-line {
            stroke: #34495e;
            stroke-width: 2;
            marker-end: url(#arrowhead);
        }
        
        .relationship-label {
            background: rgba(255, 255, 255, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: #2c3e50;
            border: 1px solid #bdc3c7;
        }
        
        .constraint-box {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .constraint-box h5 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .constraint-list {
            list-style: none;
            padding: 0;
        }
        
        .constraint-list li {
            background: rgba(255, 193, 7, 0.1);
            padding: 8px 12px;
            margin-bottom: 5px;
            border-radius: 4px;
            border-left: 3px solid #ffc107;
            font-size: 13px;
            color: #495057;
        }
        
        .examples-section {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .examples-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .example-problems {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .example-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #ddd;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .example-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }
        
        .example-card h4 {
            color: #3498db;
            margin-bottom: 10px;
        }
        
        .example-card p {
            color: #2c3e50;
            line-height: 1.5;
        }
        
        @media (max-width: 768px) {
            .nav {
                flex-direction: column;
            }
            
            .solve-controls {
                flex-direction: column;
            }
            
            .strategy-buttons {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧠 COT-DIR 智能数学解题系统</h1>
            <p>Chain-of-Thought Directed Implicit Reasoning - 数学推理与问题解决</p>
            <div class="nav">
                <a href="/" class="active">智能解题</a>
                <a href="/strategies">推理策略</a>
                <a href="/learning-guide">学习指导</a>
                <a href="/knowledge-map">知识图谱</a>
                <a href="/error-analysis">错题分析</a>
            </div>
        </div>
        
        <div class="solve-section">
            <h2>📝 数学问题求解</h2>
            
            <div class="problem-input">
                <label for="problem-text">请输入数学问题:</label>
                <textarea id="problem-text" placeholder="例如：小明有5个苹果，小红有3个苹果，他们一共有多少个苹果？"></textarea>
            </div>
            
            <div class="strategy-selection">
                <label>选择推理策略:</label>
                <div class="strategy-buttons">
                    <button class="strategy-btn active" data-strategy="auto">自动选择</button>
                    <button class="strategy-btn" data-strategy="cot">思维链推理 (COT)</button>
                    <button class="strategy-btn" data-strategy="got">思维图推理 (GOT)</button>
                    <button class="strategy-btn" data-strategy="tot">思维树推理 (TOT)</button>
                </div>
            </div>
            
            <div class="solve-controls">
                <button class="solve-btn" id="solve-btn">🚀 开始解题</button>
                <button class="clear-btn" id="clear-btn">🗑️ 清空</button>
            </div>
            
            <div class="loading" id="loading">
                <p>🤖 正在思考中，请稍候...</p>
            </div>
        </div>
        
        <div class="result-section" id="result-section">
            <h3>💡 解题结果</h3>
            <div class="answer-box">
                <div class="answer" id="answer-text">答案将在这里显示</div>
                <div class="confidence" id="confidence-text">置信度: --</div>
            </div>
            <div class="reasoning-steps">
                <h4>🔍 推理过程:</h4>
                <div id="steps-container">
                    <!-- 推理步骤将在这里显示 -->
                </div>
            </div>
            
            <div class="entity-relationship-diagram">
                <h4>🎨 实体关系图:</h4>
                <div id="diagram-container">
                    <!-- 实体关系图将在这里显示 -->
                </div>
            </div>
        </div>
        
        <div class="examples-section">
            <h3>📚 示例问题</h3>
            <div class="example-problems">
                <div class="example-card" data-problem="小明有5个苹果，小红有3个苹果，他们一共有多少个苹果？">
                    <h4>基础加法问题</h4>
                    <p>小明有5个苹果，小红有3个苹果，他们一共有多少个苹果？</p>
                </div>
                <div class="example-card" data-problem="一个长方形的长是8米，宽是5米，求它的面积和周长。">
                    <h4>几何计算问题</h4>
                    <p>一个长方形的长是8米，宽是5米，求它的面积和周长。</p>
                </div>
                <div class="example-card" data-problem="小张买了3支笔，每支笔5元，给了店主20元，应该找回多少钱？">
                    <h4>应用题</h4>
                    <p>小张买了3支笔，每支笔5元，给了店主20元，应该找回多少钱？</p>
                </div>
                <div class="example-card" data-problem="一个班级有40名学生，其中男生占60%，女生有多少人？">
                    <h4>百分比问题</h4>
                    <p>一个班级有40名学生，其中男生占60%，女生有多少人？</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let selectedStrategy = 'auto';
        
        // 策略选择
        document.querySelectorAll('.strategy-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.strategy-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                selectedStrategy = this.dataset.strategy;
            });
        });
        
        // 示例问题点击
        document.querySelectorAll('.example-card').forEach(card => {
            card.addEventListener('click', function() {
                document.getElementById('problem-text').value = this.dataset.problem;
            });
        });
        
        // 清空按钮
        document.getElementById('clear-btn').addEventListener('click', function() {
            document.getElementById('problem-text').value = '';
            document.getElementById('result-section').classList.remove('show');
        });
        
        // 解题按钮
        document.getElementById('solve-btn').addEventListener('click', function() {
            const problemText = document.getElementById('problem-text').value.trim();
            
            if (!problemText) {
                alert('请输入数学问题');
                return;
            }
            
            // 显示加载状态
            document.getElementById('loading').classList.add('show');
            document.getElementById('result-section').classList.remove('show');
            
            // 模拟API调用
            solveProblem(problemText, selectedStrategy);
        });
        
        function solveProblem(problem, strategy) {
            console.log('开始解题:', problem, strategy);
            
            // 调用实际的解题API
            fetch('/api/solve', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    problem: problem,
                    strategy: strategy
                })
            })
            .then(response => {
                console.log('收到响应:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log('解析数据:', data);
                document.getElementById('loading').classList.remove('show');
                
                if (data.success) {
                    displayResult(data);
                } else {
                    alert('解题失败: ' + (data.error || '未知错误'));
                    console.error('解题失败:', data);
                }
            })
            .catch(error => {
                console.error('请求错误:', error);
                document.getElementById('loading').classList.remove('show');
                alert('请求失败: ' + error.message);
            });
        }
        
        function displayResult(result) {
            console.log('显示结果:', result);
            
            // 显示答案
            const answerElement = document.getElementById('answer-text');
            const confidenceElement = document.getElementById('confidence-text');
            
            if (answerElement) {
                answerElement.textContent = result.answer || '未知答案';
            }
            
            if (confidenceElement) {
                const confidence = result.confidence ? (result.confidence * 100).toFixed(1) : '未知';
                const strategy = result.strategy_used ? result.strategy_used.toUpperCase() : '未知';
                confidenceElement.textContent = `置信度: ${confidence}% | 使用策略: ${strategy}`;
            }
            
            // 显示推理步骤
            const stepsContainer = document.getElementById('steps-container');
            if (stepsContainer) {
                stepsContainer.innerHTML = '';
                
                if (result.reasoning_steps && Array.isArray(result.reasoning_steps)) {
                    result.reasoning_steps.forEach(step => {
                        const stepDiv = document.createElement('div');
                        stepDiv.className = 'step';
                        stepDiv.innerHTML = `
                            <div class="step-number">步骤 ${step.step || '?'}</div>
                            <div class="step-description">${step.description || '无描述'}</div>
                        `;
                        stepsContainer.appendChild(stepDiv);
                    });
                } else {
                    stepsContainer.innerHTML = '<div class="step">没有详细的推理步骤</div>';
                }
            }
            
            // 显示实体关系图
            const diagramContainer = document.getElementById('diagram-container');
            if (diagramContainer && result.entity_relationship_diagram) {
                displayEntityRelationshipDiagram(result.entity_relationship_diagram, diagramContainer);
            }
            
            // 显示结果区域
            const resultSection = document.getElementById('result-section');
            if (resultSection) {
                resultSection.classList.add('show');
            }
        }
        
        function displayEntityRelationshipDiagram(diagram, container) {
            container.innerHTML = '';
            
            // 创建题目特定的实体关系图标题
            const titleDiv = document.createElement('div');
            titleDiv.style.textAlign = 'center';
            titleDiv.style.marginBottom = '20px';
            titleDiv.style.padding = '15px';
            titleDiv.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            titleDiv.style.color = 'white';
            titleDiv.style.borderRadius = '10px';
            titleDiv.style.fontWeight = 'bold';
            titleDiv.style.fontSize = '16px';
            titleDiv.innerHTML = `🎯 "${document.getElementById('problem-text').value.slice(0, 30)}..." 的实体关系分析`;
            container.appendChild(titleDiv);
            
            // 创建可视化的网络图
            const networkDiv = document.createElement('div');
            networkDiv.style.position = 'relative';
            networkDiv.style.height = '400px';
            networkDiv.style.background = 'white';
            networkDiv.style.border = '2px solid #e9ecef';
            networkDiv.style.borderRadius = '10px';
            networkDiv.style.padding = '20px';
            networkDiv.style.marginBottom = '20px';
            
            // 创建SVG画布
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', '100%');
            svg.setAttribute('height', '100%');
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            
            // 定义箭头标记
            const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
            const marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');
            marker.setAttribute('id', 'arrowhead');
            marker.setAttribute('markerWidth', '10');
            marker.setAttribute('markerHeight', '7');
            marker.setAttribute('refX', '9');
            marker.setAttribute('refY', '3.5');
            marker.setAttribute('orient', 'auto');
            
            const polygon = document.createElementNS('http://www.w3.org/2000/svg', 'polygon');
            polygon.setAttribute('points', '0 0, 10 3.5, 0 7');
            polygon.setAttribute('fill', '#34495e');
            
            marker.appendChild(polygon);
            defs.appendChild(marker);
            svg.appendChild(defs);
            
            // 根据实体数量计算布局
            const entities = diagram.entities;
            const positions = calculateEntityPositions(entities.length);
            
            // 绘制连接线（关系）
            diagram.relationships.forEach(rel => {
                const fromIndex = entities.findIndex(e => e.id === rel.from);
                const toIndex = entities.findIndex(e => e.id === rel.to);
                
                if (fromIndex !== -1 && toIndex !== -1) {
                    const fromPos = positions[fromIndex];
                    const toPos = positions[toIndex];
                    
                    // 计算连接点（圆的边缘而不是中心）
                    const dx = toPos.x - fromPos.x;
                    const dy = toPos.y - fromPos.y;
                    const distance = Math.sqrt(dx*dx + dy*dy);
                    const radius = 40; // 实体圆的半径
                    
                    const startX = fromPos.x + (dx/distance) * radius;
                    const startY = fromPos.y + (dy/distance) * radius;
                    const endX = toPos.x - (dx/distance) * radius;
                    const endY = toPos.y - (dy/distance) * radius;
                    
                    // 绘制连接线
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', startX);
                    line.setAttribute('y1', startY);
                    line.setAttribute('x2', endX);
                    line.setAttribute('y2', endY);
                    line.setAttribute('stroke', '#34495e');
                    line.setAttribute('stroke-width', '3');
                    line.setAttribute('marker-end', 'url(#arrowhead)');
                    svg.appendChild(line);
                    
                    // 添加关系标签
                    const midX = (startX + endX) / 2;
                    const midY = (startY + endY) / 2;
                    
                    const label = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    label.setAttribute('x', midX);
                    label.setAttribute('y', midY - 5);
                    label.setAttribute('text-anchor', 'middle');
                    label.setAttribute('font-size', '12px');
                    label.setAttribute('font-weight', 'bold');
                    label.setAttribute('fill', '#2c3e50');
                    label.textContent = `${rel.type}(${rel.weight})`;
                    
                    // 添加白色背景
                    const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                    const bbox = label.getBBox ? label.getBBox() : {x: midX-30, y: midY-15, width: 60, height: 20};
                    rect.setAttribute('x', bbox.x - 3);
                    rect.setAttribute('y', bbox.y - 3);
                    rect.setAttribute('width', bbox.width + 6);
                    rect.setAttribute('height', bbox.height + 6);
                    rect.setAttribute('fill', 'rgba(255,255,255,0.9)');
                    rect.setAttribute('stroke', '#bdc3c7');
                    rect.setAttribute('stroke-width', '1');
                    rect.setAttribute('rx', '3');
                    
                    svg.appendChild(rect);
                    svg.appendChild(label);
                }
            });
            
            networkDiv.appendChild(svg);
            
            // 创建实体节点（在SVG之上）
            entities.forEach((entity, index) => {
                const pos = positions[index];
                const entityNode = document.createElement('div');
                entityNode.className = `entity-node ${entity.type}`;
                entityNode.style.position = 'absolute';
                entityNode.style.left = (pos.x - 40) + 'px';
                entityNode.style.top = (pos.y - 20) + 'px';
                entityNode.style.width = '80px';
                entityNode.style.height = '40px';
                entityNode.style.borderRadius = '20px';
                entityNode.style.display = 'flex';
                entityNode.style.alignItems = 'center';
                entityNode.style.justifyContent = 'center';
                entityNode.style.fontSize = '12px';
                entityNode.style.fontWeight = 'bold';
                entityNode.style.textAlign = 'center';
                entityNode.style.cursor = 'pointer';
                entityNode.style.zIndex = '10';
                
                let nodeText = entity.id;
                if (entity.value !== undefined) nodeText = `${entity.id}\n${entity.value}`;
                if (entity.quantity !== undefined) nodeText = `${entity.id}\n${entity.quantity}个`;
                if (entity.owns !== undefined) nodeText = `${entity.id}\n${entity.owns}个`;
                
                entityNode.textContent = nodeText;
                entityNode.title = `类型: ${entity.type}\n属性: ${entity.properties ? entity.properties.join(', ') : '无'}`;
                
                // 添加悬停效果
                entityNode.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.1)';
                    this.style.boxShadow = '0 4px 15px rgba(0,0,0,0.3)';
                });
                
                entityNode.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = '0 2px 8px rgba(0,0,0,0.2)';
                });
                
                networkDiv.appendChild(entityNode);
            });
            
            container.appendChild(networkDiv);
            
            // 创建隐含约束显示
            if (diagram.implicit_constraints && diagram.implicit_constraints.length > 0) {
                const constraintBox = document.createElement('div');
                constraintBox.className = 'constraint-box';
                
                const constraintTitle = document.createElement('h5');
                constraintTitle.textContent = '⚖️ 题目隐含约束条件:';
                constraintBox.appendChild(constraintTitle);
                
                const constraintList = document.createElement('ul');
                constraintList.className = 'constraint-list';
                
                diagram.implicit_constraints.forEach(constraint => {
                    const constraintItem = document.createElement('li');
                    constraintItem.textContent = constraint;
                    constraintList.appendChild(constraintItem);
                });
                
                constraintBox.appendChild(constraintList);
                container.appendChild(constraintBox);
            }
            
            // 添加交互说明
            const interactionDiv = document.createElement('div');
            interactionDiv.style.marginTop = '15px';
            interactionDiv.style.padding = '10px';
            interactionDiv.style.background = '#f8f9fa';
            interactionDiv.style.borderRadius = '6px';
            interactionDiv.style.fontSize = '14px';
            interactionDiv.style.color = '#6c757d';
            interactionDiv.style.textAlign = 'center';
            interactionDiv.innerHTML = '💡 将鼠标悬停在实体节点上查看详细属性信息';
            container.appendChild(interactionDiv);
        }
        
        function calculateEntityPositions(entityCount) {
            const width = 600; // 假设容器宽度
            const height = 300; // 假设容器高度
            const centerX = width / 2;
            const centerY = height / 2;
            const positions = [];
            
            if (entityCount === 1) {
                positions.push({x: centerX, y: centerY});
            } else if (entityCount === 2) {
                positions.push({x: centerX - 100, y: centerY});
                positions.push({x: centerX + 100, y: centerY});
            } else if (entityCount === 3) {
                positions.push({x: centerX, y: centerY - 80});
                positions.push({x: centerX - 100, y: centerY + 60});
                positions.push({x: centerX + 100, y: centerY + 60});
            } else if (entityCount === 4) {
                positions.push({x: centerX - 100, y: centerY - 60});
                positions.push({x: centerX + 100, y: centerY - 60});
                positions.push({x: centerX - 100, y: centerY + 60});
                positions.push({x: centerX + 100, y: centerY + 60});
            } else {
                // 圆形布局
                const radius = Math.min(width, height) * 0.3;
                for (let i = 0; i < entityCount; i++) {
                    const angle = (2 * Math.PI * i) / entityCount - Math.PI / 2;
                    positions.push({
                        x: centerX + radius * Math.cos(angle),
                        y: centerY + radius * Math.sin(angle)
                    });
                }
            }
            
            return positions;
        }
    </script>
</body>
</html>