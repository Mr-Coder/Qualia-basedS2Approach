<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®ä½“å…³ç³»æ¨¡å—è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background-color: #f0f4f8;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0,0,0,0.08);
        }
        .error-info {
            background: #fef2f2;
            border-left: 5px solid #ef4444;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .fix-info {
            background: #ecfdf5;
            border-left: 5px solid #10b981;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .code-block {
            background: #1e293b;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 15px 0;
            line-height: 1.6;
        }
        .highlight {
            background: #3b82f6;
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
        }
        .debug-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .fix-list {
            background: #eff6ff;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .fix-item {
            margin: 10px 0;
            padding: 15px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #3b82f6;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background: #3b82f6;
            color: white;
            border-radius: 6px;
            text-decoration: none;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #2563eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” å®ä½“å…³ç³»æ¨¡å—è°ƒè¯•æŠ¥å‘Š</h1>
        
        <div class="error-info">
            <h2>âŒ é”™è¯¯ä¿¡æ¯</h2>
            <div class="code-block">
TypeError: Cannot read properties of undefined (reading 'map')
    at P2 (index-5560e701.js:68:155998)
    at zc (index-5560e701.js:38:16997)
    ...
            </div>
            <p><strong>é”™è¯¯åˆ†æï¼š</strong>æŸä¸ªæ•°ç»„æˆ–å¯¹è±¡åœ¨è°ƒç”¨ .map() æ–¹æ³•æ—¶æ˜¯ undefinedã€‚</p>
        </div>

        <h2>ğŸ› ï¸ å·²å®Œæˆçš„ä¿®å¤</h2>
        <div class="fix-list">
            <div class="fix-item">
                <strong>1. å…¨å±€ .map() å®‰å…¨æ£€æŸ¥</strong>
                <p>åœ¨ä»¥ä¸‹ä½ç½®æ·»åŠ äº†ç©ºå€¼ä¿æŠ¤ï¼š</p>
                <ul>
                    <li>InteractivePropertySmartSolver.tsx - 5å¤„ä¿®å¤</li>
                    <li>HistoryPanel.tsx - æ·»åŠ æ•°ç»„ç±»å‹æ£€æŸ¥</li>
                    <li>problemStore.ts - useHistory é€‰æ‹©å™¨å®‰å…¨è¿”å›</li>
                </ul>
            </div>
            
            <div class="fix-item">
                <strong>2. EntityRelationshipDiagram.tsx å¢å¼ºä¿æŠ¤</strong>
                <p>æ·»åŠ äº†é¢å¤–çš„ç©ºå€¼æ£€æŸ¥ï¼š</p>
                <ul>
                    <li>safeImplicitConstraints.map() â†’ (safeImplicitConstraints || []).map()</li>
                    <li>safePhysicalConstraints.map() â†’ (safePhysicalConstraints || []).map()</li>
                    <li>physicalProperties.xxx.map() â†’ physicalProperties?.xxx || []).map()</li>
                    <li>extractedEntities.map() â†’ (extractedEntities || []).map()</li>
                    <li>extractedRelationships.map() â†’ (extractedRelationships || []).map()</li>
                    <li>safeDeepRelations.map() â†’ (safeDeepRelations || []).map()</li>
                </ul>
            </div>
            
            <div class="fix-item">
                <strong>3. æ•°æ®ä¼˜å…ˆçº§è°ƒæ•´</strong>
                <p>ä¿®æ”¹äº† allEntities çš„è®¡ç®—é€»è¾‘ï¼Œä¼˜å…ˆä½¿ç”¨ä¼ å…¥çš„å®ä½“æ•°æ®ã€‚</p>
            </div>
            
            <div class="fix-item">
                <strong>4. æä¾›é»˜è®¤æ•°æ®</strong>
                <p>åœ¨ App.tsx ä¸­ä¸º EntityRelationshipDiagram æä¾›äº†é»˜è®¤ç¤ºä¾‹æ•°æ®ã€‚</p>
            </div>
        </div>

        <h2>ğŸ”§ è°ƒè¯•å»ºè®®</h2>
        <div class="debug-section">
            <h3>å¯èƒ½çš„å…¶ä»–åŸå› </h3>
            <ol>
                <li><strong>ç¬¬ä¸‰æ–¹åº“é—®é¢˜ï¼š</strong>framer-motion æˆ–å…¶ä»–åº“å¯èƒ½åœ¨å†…éƒ¨è°ƒç”¨ .map()</li>
                <li><strong>å¼‚æ­¥æ•°æ®åŠ è½½ï¼š</strong>æŸäº›æ•°æ®å¯èƒ½åœ¨ç»„ä»¶æŒ‚è½½æ—¶è¿˜æœªå‡†å¤‡å¥½</li>
                <li><strong>çŠ¶æ€ç®¡ç†é—®é¢˜ï¼š</strong>Zustand store å¯èƒ½åœ¨æŸäº›æƒ…å†µä¸‹è¿”å› undefined</li>
                <li><strong>ç¼“å­˜æ•°æ®æŸåï¼š</strong>localStorage ä¸­çš„æŒä¹…åŒ–æ•°æ®å¯èƒ½å·²æŸå</li>
            </ol>

            <h3>æ’æŸ¥æ­¥éª¤</h3>
            <div class="code-block">
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œ localStorage
   - æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
   - Application â†’ Storage â†’ Clear site data

2. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°
   - æŸ¥çœ‹å®Œæ•´çš„é”™è¯¯å †æ ˆ
   - æŸ¥æ‰¾é”™è¯¯å‘ç”Ÿçš„å…·ä½“æ–‡ä»¶å’Œè¡Œå·

3. å¯ç”¨ React å¼€å‘æ¨¡å¼
   - ä½¿ç”¨ npm run dev è€Œä¸æ˜¯ç”Ÿäº§æ„å»º
   - å¼€å‘æ¨¡å¼ä¼šæä¾›æ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

4. æ·»åŠ ä¸´æ—¶è°ƒè¯•ä»£ç 
   - åœ¨ EntityRelationshipDiagram å¼€å¤´æ·»åŠ ï¼š
   console.log('EntityRelationshipDiagram props:', {
     entities, relationships, physicalConstraints
   })
            </div>
        </div>

        <h2>ğŸ§ª éªŒè¯æ­¥éª¤</h2>
        <div class="fix-info">
            <ol>
                <li>æ¸…é™¤æ‰€æœ‰æµè§ˆå™¨æ•°æ®</li>
                <li>é‡æ–°å¯åŠ¨å¼€å‘æœåŠ¡å™¨: <code>npm run dev</code></li>
                <li>æ‰“å¼€æ–°çš„éšèº«çª—å£è®¿é—®åº”ç”¨</li>
                <li>ç›´æ¥ç‚¹å‡»"å®ä½“å…³ç³»"æ ‡ç­¾</li>
                <li>è§‚å¯Ÿæ˜¯å¦æ˜¾ç¤ºç¤ºä¾‹æ•°æ®è€Œä¸æ˜¯é”™è¯¯</li>
            </ol>
        </div>

        <h2>ğŸ“‹ ä¸‹ä¸€æ­¥è¡ŒåŠ¨</h2>
        <div class="debug-section">
            <p>å¦‚æœé”™è¯¯ä»ç„¶å­˜åœ¨ï¼Œè¯·å°è¯•ï¼š</p>
            <ol>
                <li><strong>åˆ›å»ºæœ€å°å¤ç°æ¡ˆä¾‹ï¼š</strong>åˆ›å»ºä¸€ä¸ªåªåŒ…å« EntityRelationshipDiagram çš„ç®€å•é¡µé¢</li>
                <li><strong>é€æ­¥è°ƒè¯•ï¼š</strong>åœ¨ç»„ä»¶çš„æ¯ä¸ª map è°ƒç”¨å‰æ·»åŠ  console.log</li>
                <li><strong>æ£€æŸ¥æ„å»ºè¾“å‡ºï¼š</strong>æŸ¥çœ‹ dist æ–‡ä»¶å¤¹ä¸­çš„æ„å»ºæ–‡ä»¶</li>
                <li><strong>å›é€€æµ‹è¯•ï¼š</strong>æš‚æ—¶æ³¨é‡Šæ‰æŸäº›å¤æ‚åŠŸèƒ½ï¼Œé€æ­¥æ¢å¤</li>
            </ol>
        </div>

        <div style="margin-top: 40px; text-align: center;">
            <a href="index.html" class="btn">è¿”å›ä¸»åº”ç”¨</a>
        </div>
    </div>

    <script>
        console.log('ğŸ” å®ä½“å…³ç³»æ¨¡å—è°ƒè¯•é¡µé¢å·²åŠ è½½');
        console.log('âœ… å·²åº”ç”¨çš„ä¿®å¤ï¼š');
        console.log('  - å…¨å±€ .map() å®‰å…¨æ£€æŸ¥');
        console.log('  - EntityRelationshipDiagram å¢å¼ºä¿æŠ¤');
        console.log('  - æ•°æ®ä¼˜å…ˆçº§è°ƒæ•´');
        console.log('  - æä¾›é»˜è®¤æ•°æ®');
        console.log('');
        console.log('âš ï¸ å¦‚æœé”™è¯¯ä»ç„¶å­˜åœ¨ï¼Œè¯·æŸ¥çœ‹ä¸Šè¿°è°ƒè¯•å»ºè®®');
        
        // æ£€æŸ¥ localStorage
        console.log('ğŸ“¦ localStorage å†…å®¹:');
        for (let key in localStorage) {
            console.log(`  ${key}: ${localStorage[key].substring(0, 100)}...`);
        }
    </script>
</body>
</html>