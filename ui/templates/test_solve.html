<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>COT-DIR è§£é¢˜æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        textarea { width: 100%; height: 80px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
        button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; }
        .loading { color: #666; font-style: italic; }
        .error { color: #d32f2f; }
        .success { color: #2e7d32; }
        .debug { background: #f5f5f5; padding: 10px; margin-top: 10px; font-family: monospace; font-size: 12px; }
    </style>
</head>
<body>
    <h1>COT-DIR è§£é¢˜ç³»ç»Ÿæµ‹è¯•</h1>
    
    <div class="form-group">
        <label for="problem">æ•°å­¦é—®é¢˜:</label>
        <textarea id="problem" placeholder="è¾“å…¥æ•°å­¦é—®é¢˜ï¼Œä¾‹å¦‚ï¼šå°æ˜æœ‰5ä¸ªè‹¹æœï¼Œå°çº¢æœ‰3ä¸ªè‹¹æœï¼Œä»–ä»¬ä¸€å…±æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ"></textarea>
    </div>
    
    <div class="form-group">
        <label>æ¨ç†ç­–ç•¥:</label>
        <button type="button" onclick="solve('auto')">è‡ªåŠ¨é€‰æ‹©</button>
        <button type="button" onclick="solve('cot')">COTç­–ç•¥</button>
        <button type="button" onclick="solve('got')">GOTç­–ç•¥</button>
        <button type="button" onclick="solve('tot')">TOTç­–ç•¥</button>
    </div>
    
    <div class="form-group">
        <button type="button" onclick="testBasic()">æµ‹è¯•åŸºç¡€é—®é¢˜</button>
        <button type="button" onclick="clearResult()">æ¸…ç©ºç»“æœ</button>
    </div>
    
    <div id="result"></div>
    
    <script>
        function log(message) {
            console.log(message);
            const debugDiv = document.getElementById('debug') || createDebugDiv();
            debugDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
        }
        
        function createDebugDiv() {
            const div = document.createElement('div');
            div.id = 'debug';
            div.className = 'debug';
            div.innerHTML = '<strong>è°ƒè¯•ä¿¡æ¯:</strong><br>';
            document.body.appendChild(div);
            return div;
        }
        
        function solve(strategy) {
            const problem = document.getElementById('problem').value.trim();
            if (!problem) {
                alert('è¯·è¾“å…¥æ•°å­¦é—®é¢˜');
                return;
            }
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<div class="loading">ğŸ¤– æ­£åœ¨æ€è€ƒä¸­...</div>';
            
            log(`å¼€å§‹è§£é¢˜: ${problem}, ç­–ç•¥: ${strategy}`);
            
            fetch('/api/solve', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    problem: problem,
                    strategy: strategy
                })
            })
            .then(response => {
                log(`æ”¶åˆ°å“åº”çŠ¶æ€: ${response.status}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return response.json();
            })
            .then(data => {
                log(`è§£ææ•°æ®: ${JSON.stringify(data, null, 2)}`);
                
                if (data.success) {
                    displaySuccess(data);
                } else {
                    displayError(data.error || 'æœªçŸ¥é”™è¯¯');
                }
            })
            .catch(error => {
                log(`è¯·æ±‚å¤±è´¥: ${error.message}`);
                displayError(`è¯·æ±‚å¤±è´¥: ${error.message}`);
            });
        }
        
        function displaySuccess(result) {
            const resultDiv = document.getElementById('result');
            const steps = result.reasoning_steps || [];
            
            let stepsHtml = '';
            if (steps.length > 0) {
                stepsHtml = '<h4>æ¨ç†æ­¥éª¤:</h4><ol>';
                steps.forEach(step => {
                    stepsHtml += `<li>${step.description || 'æ— æè¿°'}</li>`;
                });
                stepsHtml += '</ol>';
            }
            
            resultDiv.innerHTML = `
                <div class="success">
                    <h3>âœ… è§£é¢˜æˆåŠŸ</h3>
                    <p><strong>ç­”æ¡ˆ:</strong> ${result.answer}</p>
                    <p><strong>ç½®ä¿¡åº¦:</strong> ${(result.confidence * 100).toFixed(1)}%</p>
                    <p><strong>ç­–ç•¥:</strong> ${result.strategy_used}</p>
                    <p><strong>æ‰§è¡Œæ—¶é—´:</strong> ${result.execution_time}ç§’</p>
                    ${stepsHtml}
                </div>
            `;
        }
        
        function displayError(message) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `<div class="error"><h3>âŒ è§£é¢˜å¤±è´¥</h3><p>${message}</p></div>`;
        }
        
        function testBasic() {
            document.getElementById('problem').value = 'å°æ˜æœ‰5ä¸ªè‹¹æœï¼Œå°çº¢æœ‰3ä¸ªè‹¹æœï¼Œä»–ä»¬ä¸€å…±æœ‰å¤šå°‘ä¸ªè‹¹æœï¼Ÿ';
            solve('auto');
        }
        
        function clearResult() {
            document.getElementById('result').innerHTML = '';
            const debugDiv = document.getElementById('debug');
            if (debugDiv) {
                debugDiv.remove();
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('é¡µé¢åŠ è½½å®Œæˆ');
        });
    </script>
</body>
</html>